monetate.c.cr({"data": "  // ////\n  //\n  // JS Action template for MNTTGF 2.0 - 6 febrero 2023\n  // Template de acci\u00f3n javascript para utilizar con las MONETATE GLOBAL FUNCTIONS (MNTTGF) basado en promesas de js\n  //\n  // ////\n  // Nueva funcionalidad:\n  //  - refactorizaci\u00f3n de promesas solo js\n\n  //# sourceURL=t524-stopover-modal-iter-4.js\n\n\n\n  (function() {\n\n\n    var testName = \"T524 - StopOver Modal (iter 4)\";\n    var variantName = \"Control\";\n    var t524 = {};\n\n    try {\n    //Carga de configuraci\u00f3n\n    configLoad();\n\n    //Validamos que estan las MNTTGFs\n    wait4MNTTGF()\n    //Si es as\u00ed procedemos con la Variante y si no registramos el problema con MNTTGF\n    .then(processVariant,falloMNTTGFLoad);\n\n    } catch (err)\n    {\n        log2Con(err.toString(), \"error\");\n    }\n\n    //-----------------------------------------\n    // CONFIGURACION DE LA VARIANTE\n    //-----------------------------------------\n\n    function configLoad() {\n\n      //log2Con(\"Cargando configuraci\u00f3n...\",\"debug\");\n\n      /* Conditions */\n      t524.RENDER_SELECTOR_INTERSTICIAL = \".ibe-header-new\";\n      t524.search_id = \"buttonSubmit1\";\n      t524.MIN_TRIP_DURATION = 7; // d\u00edas\n      t524.MAX_TRIP_DURATION = 3650; // d\u00edas\n      t524.INTERSTICIAL_SLEEP = 2; // horas\n      t524.MAX_NIGHTS = 9;\n\n      t524.diasEstancia= {\n        MX: {\n          Min: 8,\n          Max: 19\n        },\n        BR: {\n          Min: 8,\n          Max: 23\n        },\n        US: {\n          Min: 7,\n          Max: 18\n        },\n        AR: {\n          Min: 10,\n          Max: 24\n        },\n        ES: {\n          Min: 8,\n          Max: 19\n        },\n        CO: {\n          Min: 9,\n          Max: 22\n        },\n        CL: {\n          Min: 11,\n          Max: 24\n        },\n        PA: {\n          Min: 9,\n          Max: 19\n        },\n        UY: {\n          Min: 12,\n          Max: 24\n        },\n        CR: {\n          Min: 11,\n          Max: 19\n        },\n        DE: {\n          Min: 10,\n          Max: 18\n        },\n        GT: {\n          Min: 9,\n          Max: 19\n        },\n        IT: {\n          Min: 6,\n          Max: 12\n        },\n        FR: {\n          Min: 9,\n          Max: 17\n        },\n        PR: {\n          Min: 9,\n          Max: 16\n        }\n      };\n\n\n      t524.strings = {\n        es: {\n          title: \"Haz una parada en Madrid y desc\u00fabrela\",\n          body: \"Tu vuelo tiene una escala en Madrid. \u00bfPor qu\u00e9 no aprovechas nuestra tarifa con descuento y te quedas unos d\u00edas en esta incre\u00edble ciudad? Disfrutar\u00e1s de ofertas exclusivas en actividades, planes y compras.\",\n          btnReject: \"Continuar con mi selecci\u00f3n\",\n          btnAccept: \"Ir a Stopover Hola Madrid\",\n          chkReject: \"No volver a mostrar este mensaje\",\n          formIntro: \"Indica si har\u00edas la parada a la ida o a la vuelta y el total de noches que te quedar\u00edas; as\u00ed podremos darte m\u00e1s detalles de c\u00f3mo ser\u00eda tu estancia.\",\n          formOutward: \"Ida\",\n          formReturn: \"Vuelta\",\n          formNights: \"Noches\"\n        },\n        ca: {\n          title: \"Fes una parada a Madrid i descobreix-la\",\n          body: \"El teu vol fa una escala a Madrid. Per qu\u00e8 no aprofites la nostra tarifa amb descompte i et quedes uns dies a aquesta incre\u00efble ciutat? Gaudir\u00e0s d'ofertes exclusives en activitats, plans i compres. \",\n          btnReject: \"Continuar amb la meva selecci\u00f3\",\n          btnAccept: \"Anar a Stopover Hola Madrid\",\n          chkReject: \"No em tornis a mostrar aquest missatge\",\n          formIntro: \"Indica si faries la parada a l'anada o la tornada i el total de nits que et quedaries; d'aquesta manera podrem donar-te m\u00e9s detalls de com seria la teva estada.\",\n          formOutward: \"Anada\",\n          formReturn: \"Tornada\",\n          formNights: \"Nits\"\n        },\n        de: {\n          title: \"Machen Sie Halt in Madrid und entdecken Sie die Stadt\",\n          body: \"Ihr Flug hat eine Zwischenlandung in Madrid. Warum profitieren Sie nicht von unserem erm\u00e4\u00dfigten Tarif und verbringen ein paar Tage in dieser Stadt, die so viel zu bieten hat? Sie kommen in den Genuss exklusiver Vorteile bei Aktivit\u00e4ten, Ausfl\u00fcgen und beim Einkaufen. \",\n          btnReject: \"Mit meiner Auswahl fortfahren\",\n          btnAccept: \"Weiter zu Stopover Hola Madrid\",\n          chkReject: \"Diese Nachricht nicht mehr anzeigen\",\n          formIntro: \"Bitte geben Sie an, ob Sie auf der Hin- oder R\u00fcckreise einen Zwischenstopp einlegen m\u00f6chten und wie viele N\u00e4chte Sie insgesamt bleiben m\u00f6chten, damit wir Ihnen genauere Informationen zur Organisation Ihres Aufenthalts geben k\u00f6nnen.\",\n          formOutward: \"Hinflug\",\n          formReturn: \"R\u00fcckflug\",\n          formNights: \"\u00dcbernachtungen\"\n        },\n        en: {\n          title: \"Make a stop in Madrid and discover the city\",\n          body: \"Your flight has a stopover in Madrid. Why not take advantage of our discounted fare and stay for a few days in this wonderful city? You'll get exclusive offers on activities, plans and purchases. \",\n          btnReject: \"Continue with my selection\",\n          btnAccept: \"Go to Stopover Hola Madrid\",\n          chkReject: \"Don't show this message again\",\n          formIntro: \"Indicate whether you would make a stop on your outward or return journey and the total number of nights you would stay so we can give you more details about your options.\",\n          formOutward: \"One way\",\n          formReturn: \"Return\",\n          formNights: \"Nights\"\n        },\n        fr: {\n          title: \"Faites une halte \u00e0 Madrid et profitez-en pour la d\u00e9couvrir\",\n          body: \"Votre vol comprend une escale \u00e0 Madrid. Pourquoi ne pas profiter de notre tarif r\u00e9duit et passer quelques jours dans cette ville incroyable\u00a0? Vous profiterez d'offres exclusives sur les activit\u00e9s et vos achats. \",\n          btnReject: \"Poursuivre avec ma s\u00e9lection\",\n          btnAccept: \"Acc\u00e9der \u00e0 Stopover Hola Madrid\",\n          chkReject: \"Ne plus afficher ce message\",\n          formIntro: \"Indiquez si vous feriez l'arr\u00eat \u00e0 l'aller ou au retour et le nombre total de nuits que vous resteriez\u00a0; afin que nous puissions vous donner plus de d\u00e9tails sur votre s\u00e9jour.\",\n          formOutward: \"Aller simple\",\n          formReturn: \"Retour\",\n          formNights: \"Nuits\"\n        },\n        it: {\n          title: \"Fai una sosta per scoprire Madrid\",\n          body: \"Il tuo volo fa scalo a Madrid. Perch\u00e9 non approfittare della nostra tariffa scontata per trascorrere qualche giorno in questa citt\u00e0 straordinaria? Usufruirai di offerte esclusive su attivit\u00e0, programmi e acquisti. \",\n          btnReject: \"Prosegui con la mia selezione\",\n          btnAccept: \"Vai a Stopover Hola Madrid\",\n          chkReject: \"Non mostrare di nuovo questo messaggio\",\n          formIntro: \"Indica se preferisci fermarti all'andata o al ritorno e il numero totale di notti di permanenza, in modo da poterti fornire maggiori dettagli sul tuo soggiorno.\",\n          formOutward: \"Andata\",\n          formReturn: \"Ritorno\",\n          formNights: \"Notti\"\n        },\n        ja: {\n          title: \"\u30de\u30c9\u30ea\u30fc\u30c9\u306b\u6ede\u5728\u3057\u3066\u3001\u89b3\u5149\u3067\u304d\u307e\u3059\",\n          body: \"\u304a\u5ba2\u69d8\u306e\u3054\u4e88\u7d04\u306b\u306f\u30de\u30c9\u30ea\u30fc\u30c9\u3067\u306e\u4e57\u308a\u7d99\u304e\u304c\u542b\u307e\u308c\u3066\u3044\u307e\u3059\u3002 \u5272\u5f15\u4ed8\u304d\u306e\u904b\u8cc3\u3092\u6d3b\u7528\u3057\u3066\u3001\u3053\u306e\u7d20\u6575\u306a\u8857\u306b\u6570\u65e5\u6ede\u5728\u3057\u3066\u307f\u307e\u305b\u3093\u304b\u3002 \u30a2\u30af\u30c6\u30a3\u30d3\u30c6\u30a3\u30fb\u30d7\u30e9\u30f3\u30fb\u30b7\u30e7\u30c3\u30d4\u30f3\u30b0\u306e\u5c02\u7528\u5272\u5f15\u3092\u304a\u697d\u3057\u307f\u3044\u305f\u3060\u3051\u307e\u3059\u3002 \",\n          btnReject: \"\u9078\u629e\u3092\u305d\u306e\u307e\u307e\u306b\u3057\u3066\u7d9a\u3051\u308b\u3002\",\n          btnAccept: \"Stopover Hola Madrid\u3092\u898b\u308b\",\n          chkReject: \"\u3053\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u518d\u5ea6\u8868\u793a\u3057\u306a\u3044\",\n          formIntro: \"\u5f80\u8def\u307e\u305f\u306f\u5fa9\u8def\u306e\u3069\u3061\u3089\u3067\u306e\u3054\u5229\u7528\u3001\u5408\u8a08\u306e\u5bbf\u6cca\u65e5\u6570\u3092\u304a\u6559\u3048\u3044\u305f\u3060\u3051\u308c\u3070\u3001\u3054\u6ede\u5728\u304c\u3069\u306e\u3088\u3046\u306a\u3082\u306e\u306b\u306a\u308b\u304b\u306b\u3064\u3044\u3066\u8a73\u3057\u304f\u304a\u77e5\u3089\u305b\u3044\u305f\u3057\u307e\u3059\u3002\",\n          formOutward: \"\u5f80\u8def\",\n          formReturn: \"\u5fa9\u8def\",\n          formNights: \"\u6cca\"\n        },\n        nl: {\n          title: \"Maak een stop in Madrid en ontdek het\",\n          body: \"Maakt je vlucht een tussenlanding in Madrid? Waarom profiteer je niet van ons kortingstarief en verblijf je een paar dagen in deze ongelooflijke stad? Je zult genieten van exclusieve aanbiedingen voor activiteiten, plannen en aankopen. \",\n          btnReject: \"Doorgaan met mijn keuze\",\n          btnAccept: \"Ga naar Stopover Hola Madrid\",\n          chkReject: \"Dit bericht niet opnieuw tonen\",\n          formIntro: \"Geef aan of je op de heen- of terugreis zou stoppen en hoeveel nachten je zou blijven; zodat we je meer details kunnen geven over hoe je verblijf zou zijn.\",\n          formOutward: \"Enkele reis\",\n          formReturn: \"Retour\",\n          formNights: \"Overnachtingen\"\n        },\n        pt: {\n          title: \"Fa\u00e7a uma parada em Madri e descubra-a\",\n          body: \"Seu voo tem escala em Madri. Por que voc\u00ea n\u00e3o aproveita nossa tarifa com desconto e fica alguns dias nesta incr\u00edvel cidade? Voc\u00ea desfrutar\u00e1 de ofertas exclusivas em atividades, planos e compras. \",\n          btnReject: 'Continuar com \"Minha sele\u00e7\u00e3o\"',\n          btnAccept: \"Ir para Stopover Hola Madrid\",\n          chkReject: \"N\u00e3o mostrar esta mensagem novamente\",\n          formIntro: \"Indique se faria a parada na ida ou na volta e o n\u00famero total de noites que ficaria, para que possamos dar mais detalhes sobre como seria sua estadia.\",\n          formOutward: \"Ida\",\n          formReturn: \"Volta\",\n          formNights: \"Noites\"\n        },\n        ru: {\n          title: \"\u0421\u0434\u0435\u043b\u0430\u0439\u0442\u0435 \u043e\u0441\u0442\u0430\u043d\u043e\u0432\u043a\u0443 \u0432 \u041c\u0430\u0434\u0440\u0438\u0434\u0435 \u0438 \u043f\u043e\u0437\u043d\u0430\u043a\u043e\u043c\u044c\u0442\u0435\u0441\u044c \u0441 \u0433\u043e\u0440\u043e\u0434\u043e\u043c\",\n          body: \"\u0412\u0430\u0448 \u0440\u0435\u0439\u0441 \u0432\u044b\u043f\u043e\u043b\u043d\u044f\u0435\u0442\u0441\u044f \u0441 \u043f\u0440\u043e\u043c\u0435\u0436\u0443\u0442\u043e\u0447\u043d\u043e\u0439 \u043e\u0441\u0442\u0430\u043d\u043e\u0432\u043a\u043e\u0439 \u0432 \u041c\u0430\u0434\u0440\u0438\u0434\u0435. \u041f\u043e\u0447\u0435\u043c\u0443 \u0431\u044b \u043d\u0435 \u0432\u043e\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c\u0441\u044f \u043d\u0430\u0448\u0438\u043c \u0442\u0430\u0440\u0438\u0444\u043e\u043c \u0441\u043e \u0441\u043a\u0438\u0434\u043a\u043e\u0439 \u0438 \u043d\u0435 \u043f\u0440\u043e\u0432\u0435\u0441\u0442\u0438 \u043d\u0435\u0441\u043a\u043e\u043b\u044c\u043a\u043e \u0434\u043d\u0435\u0439 \u0432 \u044d\u0442\u043e\u043c \u043d\u0435\u0432\u0435\u0440\u043e\u044f\u0442\u043d\u043e\u043c \u0433\u043e\u0440\u043e\u0434\u0435? \u0412\u044b \u0441\u043c\u043e\u0436\u0435\u0442\u0435 \u0432\u043e\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c\u0441\u044f \u044d\u043a\u0441\u043a\u043b\u044e\u0437\u0438\u0432\u043d\u044b\u043c\u0438 \u043f\u0440\u0435\u0434\u043b\u043e\u0436\u0435\u043d\u0438\u044f\u043c\u0438 \u043d\u0430 \u043c\u0435\u0440\u043e\u043f\u0440\u0438\u044f\u0442\u0438\u044f, \u044d\u043a\u0441\u043a\u0443\u0440\u0441\u0438\u0438 \u0438 \u0448\u043e\u043f\u0438\u043d\u0433. \",\n          btnReject: \"\u041f\u0440\u043e\u0434\u043e\u043b\u0436\u0438\u0442\u044c \u0441 \u0442\u0435\u043a\u0443\u0449\u0438\u043c \u0432\u044b\u0431\u043e\u0440\u043e\u043c\",\n          btnAccept: \"\u041f\u0435\u0440\u0435\u0439\u0442\u0438 \u043a \u0443\u0441\u043b\u0443\u0433\u0435 Stopover Hola Madrid\",\n          chkReject: \"\u0411\u043e\u043b\u044c\u0448\u0435 \u043d\u0435 \u043f\u043e\u043a\u0430\u0437\u044b\u0432\u0430\u0442\u044c \u044d\u0442\u043e \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435\",\n          formIntro: \"\u0423\u043a\u0430\u0436\u0438\u0442\u0435, \u0445\u043e\u0442\u0438\u0442\u0435 \u043b\u0438 \u0432\u044b \u0441\u0434\u0435\u043b\u0430\u0442\u044c \u043e\u0441\u0442\u0430\u043d\u043e\u0432\u043a\u0443 \u043f\u0440\u0438 \u043f\u0435\u0440\u0435\u043b\u0435\u0442\u0435 \u0432 \u0432\u0430\u0448 \u043f\u0443\u043d\u043a\u0442 \u043d\u0430\u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f \u0438\u043b\u0438 \u043d\u0430 \u043e\u0431\u0440\u0430\u0442\u043d\u043e\u043c \u043f\u0443\u0442\u0438, \u0438 \u0432\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u043e\u0431\u0449\u0435\u0435 \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u043d\u043e\u0447\u0435\u0439, \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u0445\u043e\u0442\u0438\u0442\u0435 \u043f\u0440\u043e\u0432\u0435\u0441\u0442\u0438 \u0432 \u041c\u0430\u0434\u0440\u0438\u0434\u0435, \u0447\u0442\u043e\u0431\u044b \u043c\u044b \u043c\u043e\u0433\u043b\u0438 \u043f\u0440\u0435\u0434\u043e\u0441\u0442\u0430\u0432\u0438\u0442\u044c \u0432\u0430\u043c \u0431\u043e\u043b\u0435\u0435 \u043f\u043e\u0434\u0440\u043e\u0431\u043d\u0443\u044e \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044e \u043e \u0442\u043e\u043c, \u043a\u0430\u043a\u0438\u043c \u043c\u043e\u0436\u0435\u0442 \u0431\u044b\u0442\u044c \u0432\u0430\u0448\u0435 \u043f\u0440\u0435\u0431\u044b\u0432\u0430\u043d\u0438\u0435.\",\n          formOutward: \"\u0422\u0443\u0434\u0430\",\n          formReturn: \"\u041e\u0431\u0440\u0430\u0442\u043d\u043e\",\n          formNights: \"\u041d\u043e\u0447\u0435\u0439\"\n        },\n        zh: {\n          title: \"\u5728\u9a6c\u5fb7\u91cc\u505c\u7559\u5e76\u53bb\u4e86\u89e3\u5b83\",\n          body: \"\u60a8\u7684\u822a\u73ed\u4f1a\u5728\u9a6c\u5fb7\u91cc\u4e2d\u9014\u505c\u7559\u3002 \u4e3a\u4ec0\u4e48\u4e0d\u597d\u597d\u5229\u7528\u6211\u4eec\u7684\u6298\u6263\u7968\u4ef7\uff0c\u5728\u8fd9\u5ea7\u4ee4\u4eba\u96be\u4ee5\u7f6e\u4fe1\u7684\u57ce\u5e02\u9017\u7559\u51e0\u5929\u5462\uff1f \u60a8\u5c06\u4eab\u53d7\u6709\u5173\u6d3b\u52a8\u3001\u8ba1\u5212\u548c\u8d2d\u7269\u7684\u72ec\u5bb6\u4f18\u60e0\u3002 \",\n          btnReject: \"\u7ee7\u7eed\u6211\u7684\u9009\u62e9\",\n          btnAccept: \"\u524d\u5f80 Stopover Hola Madrid\",\n          chkReject: \"\u4e0d\u518d\u663e\u793a\u6b64\u4fe1\u606f\",\n          formIntro: \"\u53ea\u8981\u8ba9\u6211\u4eec\u77e5\u9053\u60a8\u662f\u5728\u53bb\u7a0b\u8fd8\u662f\u56de\u7a0b\u65f6\u505c\u7559\u4ee5\u53ca\u8981\u505c\u7559\u7684\u603b\u5929\u6570\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u4e3a\u60a8\u63d0\u4f9b\u66f4\u591a\u5173\u4e8e\u4f4f\u5bbf\u4f53\u9a8c\u7684\u8be6\u7ec6\u4fe1\u606f\u3002\",\n          formOutward: \"\u53bb\u7a0b\",\n          formReturn: \"\u8fd4\u7a0b\",\n          formNights: \"\u665a\"\n        }\n      };\n\n      t524.idioma = window.datalayer_general.idioma;\n      t524.mercado=window.datalayer_general.mercado;\n\n      t524.origin = \"\";\n      t524.destiny = \"\";\n      t524.origin_code = \"\";\n      t524.destiny_code = \"\";\n      t524.origin_string = \"\";\n      t524.destiny_string = \"\";\n\n      t524.flight_departure = \"\";\n      t524.flight_return = \"\";\n\n      t524.output_menu = \"\";\n      t524.output_intersticial = \"\";\n\n      t524.firstSearchClick = true;\n      t524.search_rc = {};\n      t524.search_mask = \"\";\n\n      t524.originsJSON = [];\n      t524.destinationsJSON = [];\n      t524.isvalidOD = false;\n      t524.isvalidDuration = false;\n\n      // t524.urlParams = new URLSearchParams(window.location.search); --> REQUIRE URLSearchParams-polyfill.js\n      t524.targetIdioma = \"es ca de fr en pt nl it ru zh ja\";\n      // t524.targetMercado = \"ES DO SV EC GT CR PE PA MX CO UY AR CL FR DE GB US PR BR BE GR IE AT PT NL IT DK HU CZ IL RU SE CH CN JP\";\n\n      t524.cumpleCondiciones = true;\n\n      t524.formInteract = false;\n\n\n      // nivel de criticidad de los mensajes de consola\n      t524.defaultLogLevel = \"debug\";\n      //Para dejar trazas en el DOM\n      // t524.defaultLogLevel = \"info\";\n    }\n\n    //-----------------------------------------\n    // FILTROS Y PROCESADO DE LA VARIANTE\n    //-----------------------------------------\n\n    function processVariant () {\n\n      //Filtros de la Experiencia\n      checkPageReady()\n      .then(respuesta => checkConditions(previousReject))\n      // .then(respuesta => checkTarget(t524.targetMercado,datalayer_general.mercado,\"Mercado\"))\n      .then(respuesta => checkTarget(t524.targetIdioma,datalayer_general.idioma,\"Idioma\"))\n\n      //Lanzamos la Experiencia\n      .then(respuesta => renderVariant())\n\n      //Control de errores: captura y traza\n      .catch(err => {\n          log2Con(\"Error!!! \" + err.toString(), \"error\");\n        });\n\n    }\n\n    /// functiones de propias de la variante\n    ///////////////////////////////////////////////////////////////////////////////////////////////////////\n\n    function previousReject() {\n\n      if (localStorage.getItem(\"mm_t524_check_reject\") == \"true\") {\n        log2Con(\"init: EXIT Tiene seleccionado 'No volver a mostrar el mensaje'\", t524.defaultLogLevel);\n\n        return false;\n\n      } else {\n        if (localStorage.getItem(\"mm_t524_btn_reject\") != null && (Date.now() - localStorage.getItem(\"mm_t524_btn_reject\")) / 1000 / 60 / 60 <= t524.INTERSTICIAL_SLEEP) {\n          log2Con(\"init: EXIT Click en 'Continuar con mi selecci\u00f3n' hace \" + (Date.now() - localStorage.getItem(\"mm_t524_btn_reject\")) / 1000 / 60 / 60 + \" horas, dormir hasta que pasen \" + t524.INTERSTICIAL_SLEEP + \" horas\", t524.defaultLogLevel);\n\n          return false;\n\n        } else {\n\n          t524.origin = document.querySelector(\"#flight_origin1\").value;\n          t524.origin_code = t524.origin.substring(t524.origin.indexOf(\"(\") + 1, t524.origin.indexOf(\")\"));\n          t524.origin_string = t524.origin.substring(0, t524.origin.indexOf(\"(\"));\n\n          t524.destiny = document.querySelector(\"#flight_destiny1\").value;\n          t524.destiny_code = t524.destiny.substring(t524.destiny.indexOf(\"(\") + 1, t524.destiny.indexOf(\")\"));\n          t524.destiny_string = t524.destiny.substring(0, t524.destiny.indexOf(\"(\"));\n\n          // log2Con(\"init origin: \" + t524.origin + \" | \" + t524.origin_code + \" | \" + t524.origin_string, t524.defaultLogLevel);\n          // log2Con(\"init destiny: \" + t524.destiny + \" | \" + t524.destiny_code + \" | \" + t524.destiny_string, t524.defaultLogLevel);\n\n          return true;\n\n        }\n      }\n\n    }\n\n    function attachSearchEvents() {\n      log2Con(\"attachChangeEvents\", t524.defaultLogLevel);\n      document.addEventListener(\"click\", searchButtonCatch, true);\n    }\n\n    function searchButtonCatch(event) {\n      if ((event.target.id === t524.search_id || event.target.parentNode.id === t524.search_id) && t524.firstSearchClick == true) {\n        t524.firstSearchClick = false;\n\n        event.stopPropagation();\n        event.preventDefault();\n\n        log2Con(\"buttonSubmit1 click\", t524.defaultLogLevel);\n\n        t524.origin = document.querySelector(\"#flight_origin1\").value;\n        t524.origin_code = t524.origin.substring(t524.origin.indexOf(\"(\") + 1, t524.origin.indexOf(\")\"));\n        t524.origin_string = t524.origin.substring(0, t524.origin.indexOf(\"(\"));\n\n        t524.destiny = document.querySelector(\"#flight_destiny1\").value;\n        t524.destiny_code = t524.destiny.substring(t524.destiny.indexOf(\"(\") + 1, t524.destiny.indexOf(\")\"));\n        t524.destiny_string = t524.destiny.substring(0, t524.destiny.indexOf(\"(\"));\n\n        t524.flight_departure = document.querySelector(\"#flight_round_date1\").value;\n        t524.flight_return = document.querySelector(\"#flight_return_date1\").value;\n\n        log2Con(\"origin: \" + t524.origin + \" | \" + t524.origin_code + \" | \" + t524.origin_string, t524.defaultLogLevel);\n        log2Con(\"destiny: \" + t524.destiny + \" | \" + t524.destiny_code + \" | \" + t524.destiny_string, t524.defaultLogLevel);\n        log2Con(\"departure: \" + t524.flight_departure + \" | \" + t524.flight_return, t524.defaultLogLevel);\n\n        // log2Con(\"origin:\" + t524.origin, t524.defaultLogLevel);\n        // log2Con(\"origin_string:\" + t524.origin_string, t524.defaultLogLevel);\n        // log2Con(\"origin_code:\" + t524.origin_code, t524.defaultLogLevel);\n        // log2Con(\"destiny:\" + t524.destiny, t524.defaultLogLevel);\n        // log2Con(\"destiny_string:\" + t524.destiny_string, t524.defaultLogLevel);\n        // log2Con(\"destiny_code:\" + t524.destiny_code, t524.defaultLogLevel);\n        // log2Con(\"flight_departure:\" + t524.flight_departure, t524.defaultLogLevel);\n        // log2Con(\"flight_return:\" + t524.flight_return, t524.defaultLogLevel);\n\n        isValidCombination();\n      }\n    }\n\n    //Check if connection origin <-> destination is possible (main.js)\n    function checkCityConnection(json, inputSelected, inputCheck) {\n      var isConnected = false;\n      if (inputCheck.length > 0) {\n        connected: for (var i = 0; i < json.length; i++) {\n          var objCities = json[i].cities;\n          for (var j = 0; j < objCities.length; j++) {\n            if (inputSelected.indexOf(objCities[j].code) > 0) {\n              var areasConnectionsCities = objCities[j].areaConnections;\n              for (var k = 0; k < areasConnectionsCities.length; k++) {\n                if (areasConnectionsCities[k].cities.length > 0) {\n                  var connectionsCities = areasConnectionsCities[k].cities;\n                  for (var l = 0; l < connectionsCities.length; l++) {\n                    //                    if (inputCheck.indexOf(connectionsCities[l].code) > 0) {  // 31/10/19 cambio formato JSON servicio\n                    if (inputCheck.indexOf(connectionsCities[l]) > 0) {\n                      // 31/10/19 cambio formato JSON servicio\n                      isConnected = true;\n                      break connected;\n                    }\n                  }\n                }\n              }\n            }\n          }\n        }\n      }\n      return isConnected;\n    }\n\n    function isValidCombination() {\n      log2Con(\"isValidCombination: \" + t524.origin_code + \" | \" + t524.destiny_code, t524.defaultLogLevel);\n\n      t524.isvalidOD = checkCityConnection(t524.destinationsJSON, t524.origin, t524.destiny);\n      log2Con(\"checkCityConnection: \" + t524.isvalidOD, t524.defaultLogLevel);\n\n      if(t524.diasEstancia[t524.mercado] != null){\n        t524.MIN_TRIP_DURATION = t524.diasEstancia[t524.mercado].Min;\n        t524.MAX_TRIP_DURATION = t524.diasEstancia[t524.mercado].Max;\n      }\n      log2Con(\"D\u00edas estancia \" + t524.mercado + \": \" + t524.MIN_TRIP_DURATION + \" -\" + t524.MAX_TRIP_DURATION);\n      t524.isvalidDuration = checkDatesDiff(t524.flight_departure, t524.flight_return, t524.MIN_TRIP_DURATION, t524.MAX_TRIP_DURATION);\n      log2Con(\"checkDatesDiff: \" + t524.isvalidDuration, t524.defaultLogLevel);\n\n      // console.log(\"524 isValidCombination:\\n__ t524.isvalidOD: \" + t524.isvalidOD + \"\\n__ !document.querySelector('#paywithAvios').checked: \" + !document.querySelector(\"#paywithAvios\").checked + \"\\n__ !document.querySelector('#paywithPoints').checked: \" + !document.querySelector(\"#paywithPoints\").checked + \"\\n__ t524.isvalidDuration: \" + t524.isvalidDuration);\n\n      if (t524.isvalidOD && !document.querySelector(\"#paywithAvios\").checked && !document.querySelector(\"#paywithPoints\").checked && t524.isvalidDuration) {\n        log2Con(\"isValidCombination: true\", t524.defaultLogLevel);\n        printModal();\n      } else {\n        log2Con(\"isValidCombination: false\", t524.defaultLogLevel);\n        // create debugger [t524_breakpoint] to read console\n        t524.firstSearchClick = false;\n        document.querySelector(\"#buttonSubmit1\").click();\n      }\n    }\n\n    function checkDatesDiff(date_departure, date_return, min_duration, max_duration) {\n      var hasDiff = false;\n\n      var year, month, day, date_diff;\n\n      log2Con(\"checkDatesDiff date_format: \" + document.getElementById(\"flight_round_date1\").placeholder, t524.defaultLogLevel);\n\n      if (date_return == \"\") {\n        log2Con(\"checkDatesDiff Solo Ida\", t524.defaultLogLevel);\n        hasDiff = true;\n      } else {\n        switch (document.getElementById(\"flight_round_date1\").placeholder) {\n          case \"DD/MM/YYYY\":\n            year = date_departure.substring(6, 10);\n            month = date_departure.substring(3, 5) - 1;\n            day = date_departure.substring(0, 2);\n            date_departure = new Date(year, month, day);\n\n            year = date_return.substring(6, 10);\n            month = date_return.substring(3, 5) - 1;\n            day = date_return.substring(0, 2);\n            date_return = new Date(year, month, day);\n            break;\n          case \"MM/DD/YYYY\":\n            year = date_departure.substring(6, 10);\n            month = date_departure.substring(0, 2) - 1;\n            day = date_departure.substring(3, 5);\n            date_departure = new Date(year, month, day);\n\n            year = date_return.substring(6, 10);\n            month = date_return.substring(0, 2) - 1;\n            day = date_return.substring(3, 5);\n            date_return = new Date(year, month, day);\n            break;\n        }\n\n        date_diff = (date_return - date_departure) / 1000 / 60 / 60 / 24;\n\n        log2Con(\"checkDatesDiff: \" + date_departure + \" | \" + date_return + \" | \" + date_diff, t524.defaultLogLevel);\n\n        if (date_diff >= min_duration && date_diff <= max_duration) hasDiff = true;\n      }\n\n      // log2Con(\"checkDatesDiff: \" + hasDiff, t524.defaultLogLevel);\n      return hasDiff;\n    }\n\n    function getOD() {\n      // var dfd = $.Deferred();\n\n      $.ajax({\n          encoding: \"UTF-8\",\n          method: \"GET\",\n          url: \"/cs/Satellite\",\n          dataType: \"html\",\n          data: {\n            pagename: \"IB_SE/CacheControl6h/BrowserCache3600/Seeker/CitiesStopOver\",\n            market: t524.mercado,\n            locale: t524.idioma,\n            d: \"\"\n          },\n          success: function(data) {\n            if (data.length > 0) {\n              t524.originsJSON = JSON.parse(data)[0]; // $.parseJSON(data)[0];\n              t524.destinationsJSON = JSON.parse(data)[1]; // $.parseJSON(data)[1];\n              // log2Con(\"getOD: \\n origen: \", t524.defaultLogLevel);\n              // log2Con(t524.originsJSON, t524.defaultLogLevel);\n              // log2Con(\"\\n destino: \", t524.defaultLogLevel);\n              // log2Con(t524.destinationsJSON, t524.defaultLogLevel);\n              // dfd.resolve();\n              attachSearchEvents();\n            }\n          }\n        })\n        .fail(function(jqXHR, textStatus, errorThrown) {\n          log2Con(\"getOD ERROR:\" + jqXHR + \" | \" + textStatus + \" | \" + errorThrown, t524.defaultLogLevel);\n        });\n\n      // return dfd.promise();\n    }\n\n    function printModal() {\n      log2Con(\"printModal\", t524.defaultLogLevel);\n\n\n\n        log2Con(\"OK - Rendered\",\"warning\");\n        log2GTM(testName, \"Modal Vista\");\n        window.monetateQ.push([\"trackEvent\",[\"modal-open-206\"]]);\n\n\n        document.querySelector(\"#buttonSubmit1\").click();\n\n\n    }\n\n\n    function renderVariant() {\n\n      // Variant status definition\n      ////////////////////////////\n\n      // If at that point you are defining listener, observers, or other artifacts that doesn't change el original application behaviour,\n      // report now the experience status as \"OK - Waiting\" and include a status change to \"OK - Rendered\" in the listener/observer definition\n\n      log2Con(\"OK - Waiting\",\"warning\");\n\n      // If you are modifing the original application behaviour, then report as \"OK - Rendered\"\n\n      // log2Con(\"OK - Rendered\",\"warning\");\n      log2GTM();\n\n      // Your code here!!!\n      ///////////////////////////////\n\n      getOD();\n\n      ///////////////////////////////\n\n      log2Con(\"Fin de la variante\",\"info\");\n    }\n\n\n\n    /// functiones core del template\n    ///////////////////////////////////////////////////////////////////////////////////////////////////////\n\n\n\n    function wait4MNTTGF() {\n      return new Promise(function(resolve,reject) {\n\n        console.debug(new Date().toLocaleString(\"es-ES\",{timeZoneName:\"short\"}) + \" - [\" + testName + \"|\" + variantName + \"] - waiting 4 MNTTGF to load...\");\n\n        //Evaluamos si las MNTTGF se han cargado cada 100 milisegundos y si es as\u00ed resolvemos la promesa\n        setTimeout(() => {\n          const intervalMNTTGF = setInterval(function() {\n            if (window.mnttGF) {\n              log2Con(\"MNTTGF running!! :)\",\"info\");\n              clearInterval(intervalMNTTGF);\n              clearTimeout(timeoutMGTTGF);\n              resolve();\n            } else if (window.mnttGF==\"locked\") {\n              log2Con(\"ATTENTION!!!! MNTTGF LOCKED!!!!!!!!!!!!!!!!!!!!!!!!! :(\",\"warning\");\n              clearInterval(intervalMNTTGF);\n              clearTimeout(timeoutMGTTGF);\n              resolve();\n            } else if (window.mnttGF==\"loading\") {\n              log2Con(\"loading MNTTGF... :|\",\"info\");\n            }\n          },100);\n\n          //Si tras 10 segundos no se han cargado las MNTTGF rechazamos la promesa\n          const timeoutMGTTGF = setTimeout(() => {\n            clearInterval(intervalMNTTGF);\n            reject();\n          },10000);\n        },0);\n\n\n      });\n    }\n\n    function falloMNTTGFLoad() {\n      timestamp = new Date().toLocaleString(\"es-ES\",{timeZoneName:\"short\"});\n      texto = \"MNTTGF TIMEOUT!!!: No se ha cargado la experiencia MONETATE GLOBAL FUNCTIONS :(\";\n      aviso = timestamp + \" [\" + testName + \"|\" + variantName + \"]:--> \" + texto;\n\n      console.error(aviso);\n\n      avisoHTML='<div class=\"mnttgf_error\">' + timestamp + ': ' + texto + '</div>';\n\n      // lo metemos en el DOM para que lo registre QM\n\n      if (document.getElementById(\"MNTT_LOGS\")==null) {\n        output = '<div data-nosnippet id=\"MNTT_LOGS\" class=\"mnttgf_logs\" style=\"display: none;\"></div>';\n        document.querySelector(\"body\").insertAdjacentHTML(\"beforeend\", output);\n      }\n\n      idText = (testName + '_' + variantName).trim();\n\n      if (document.getElementById(idText) == null) {\n        output = '<div id=\"' + idText + '\" class=\"mnttgf_logs\" style=\"display: none;\">Monetate log: [' + testName + '][' + variantName + '] </div>';\n        document.getElementById(\"MNTT_LOGS\").insertAdjacentHTML(\"beforeend\", output);\n      }\n\n      document.getElementById(idText).insertAdjacentHTML(\"beforeend\",avisoHTML);\n    }\n\n\n\n    /// funciones proxy para MNTTGF\n    /////////////////////////////////////////////\n\n    function checkPageReady(pageCondition = function() {return true;}){\n      return mnttCheckPageReady(testName,variantName,pageCondition);\n    }\n\n    function checkConditions(funcionCondicion,conditionDescription = \"\") {\n      return mnttCheckConditions(testName,variantName,funcionCondicion,conditionDescription);\n    }\n\n    function checkTarget(target,currentValue,targetDescription = \"\") {\n      return mnttCheckTarget(testName,variantName,target,currentValue,targetDescription);\n    }\n\n    function log2Con(texto,criticidad = \"info\") {\n        mnttLog2Con(testName,variantName,texto,criticidad);\n    }\n\n    function obj2Con(objeto) {\n        mnttObj2Con(testName,variantName,objeto);\n    }\n\n    function log2GTM(test = testName, action = variantName) {\n        mnttLog2GTM(test,action);\n    }\n\n    function sendEventQM(eventNum,eventValue = \"\",eventDesc=\"\")\n    {\n        mnttSendEventQM(testName,variantName,eventNum,eventValue,eventDesc);\n    }\n\n    /////////////////////////////////////////\n\n  })();\n\n", "ref": "1123/5326609.js"});